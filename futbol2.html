<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLUB SEÑOR CRISTO ASCENSION - Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap');
        
        :root {
            --primary: #1e3a8a;
            --secondary: #eab308;
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            scroll-behavior: smooth;
        }

        .page-section { display: none; }
        .page-section.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-nav {
            background: rgba(30, 58, 138, 0.98);
            backdrop-filter: blur(10px);
        }

        .soccer-hero {
            background: linear-gradient(rgba(30, 58, 138, 0.85), rgba(23, 37, 84, 0.95)), 
                        url('https://images.unsplash.com/photo-1574629810360-7efbbe195018?auto=format&fit=crop&q=80&w=2000');
            background-size: cover;
            background-position: center;
        }

        .carousel-item { 
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            object-fit: cover;
            z-index: 1;
        }
        .carousel-item.active { 
            opacity: 1; 
            z-index: 2;
        }
        
        .admin-dark-bg { background-color: #020617; }

        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: invert(0.8) sepia(1) saturate(5) hue-rotate(10deg);
        }

        .success-animation {
            animation: scaleIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .logo-img {
            width: 45px;
            height: 45px;
            object-fit: contain;
        }

        #reg-submit-btn:disabled {
            background-color: #94a3b8;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .flip-card {
            background-color: transparent;
            perspective: 1000px;
            min-height: 380px;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .flip-card:hover .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 3rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            border: 1px solid #f1f5f9;
        }

        .flip-card-front {
            background-color: #f8fafc;
            color: #1e3a8a;
        }

        .flip-card-back {
            background-color: #1e3a8a;
            color: white;
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="bg-slate-50 text-gray-900">

    <!-- Navbar Premium -->
    <nav class="glass-nav text-white sticky top-0 z-50 shadow-2xl border-b border-white/10">
        <div class="max-w-7xl mx-auto px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="window.showPage('home')">
                <div class="bg-[#eab308] p-1 rounded-xl shadow-lg shadow-yellow-500/20 transform group-hover:rotate-12 transition-transform overflow-hidden text-center flex items-center justify-center">
                    <img src="logo.jpg" alt="Logo Club" class="logo-img" onerror="this.src='https://img.icons8.com/color/96/football.png'">
                </div>
                <div class="flex flex-col">
                    <span class="font-black text-xl tracking-tighter italic uppercase leading-none">CLUB SECRISAS</span>
                    <span class="text-[#eab308] text-[10px] font-black tracking-[0.3em] uppercase">CRISTO ASCENSION</span>
                </div>
            </div>
            
            <div class="flex items-center gap-6 md:gap-10 font-black uppercase text-[11px] tracking-widest">
                <button onclick="window.showPage('home')" class="nav-btn hover:text-[#eab308] transition-colors border-b-2 border-transparent hover:border-[#eab308] py-1">Inicio</button>
                <button onclick="window.showPage('register')" class="nav-btn hover:text-[#eab308] transition-colors border-b-2 border-transparent hover:border-[#eab308] py-1">Inscripción</button>
                <div class="w-px h-6 bg-white/20 hidden md:block"></div>
                <button onclick="window.showPage('admin')" class="flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full hover:bg-[#eab308] hover:text-[#1e3a8a] transition-all text-[#eab308]">
                    <i data-lucide="shield-check" class="w-4 h-4"></i> Admin
                </button>
            </div>
        </div>
    </nav>

    <!-- PÁGINA: INICIO -->
    <section id="page-home" class="page-section active">
        <div class="h-[75vh] soccer-hero flex items-center justify-center text-center px-4">
            <div class="max-w-4xl">
                <div class="inline-block bg-[#eab308] text-[#1e3a8a] px-4 py-1 rounded-full font-black text-[10px] uppercase tracking-widest mb-6 animate-pulse">
                    Academia Oficial de Formación
                </div>
                <h1 class="text-white text-6xl md:text-[8rem] font-black italic uppercase leading-[0.9] mb-8 drop-shadow-2xl">
                    FE Y <span class="text-[#eab308]">PASIÓN</span>
                </h1>
                <p class="text-blue-100 text-lg md:text-2xl mb-12 font-medium uppercase tracking-[0.4em] opacity-80">Club Señor Cristo Ascension</p>
                <button onclick="window.showPage('register')" class="bg-[#eab308] hover:bg-white text-[#1e3a8a] font-black py-6 px-16 rounded-2xl text-xl uppercase transition-all hover:scale-105 shadow-2xl shadow-yellow-500/30 flex items-center justify-center gap-4 mx-auto group">
                    Inscríbete Ahora <i data-lucide="arrow-right-circle" class="group-hover:translate-x-2 transition-transform"></i>
                </button>
            </div>
        </div>

        <!-- SECCIÓN: RESEÑA -->
        <div class="py-24 bg-slate-50 overflow-hidden">
            <div class="max-w-7xl mx-auto px-6">
                <div class="grid lg:grid-cols-2 gap-16 items-center">
                    <div class="relative">
                        <div class="absolute -top-10 -left-10 w-32 h-32 bg-[#eab308]/10 rounded-full blur-3xl"></div>
                        <h2 class="text-4xl md:text-6xl font-black text-[#1e3a8a] uppercase italic leading-none mb-8">
                            Nuestra <span class="text-[#eab308]">Historia</span>
                        </h2>
                        <div class="space-y-6 text-slate-600 text-lg leading-relaxed font-medium">
                            <p>
                                Fundado con orgullo el <span class="font-black text-[#1e3a8a]">23 de agosto del 2015</span>, el Club Deportivo Señor Cristo Ascensión es una institución oficialmente registrada que nació de una profunda historia de fe y un amor incondicional por el fútbol.
                            </p>
                            <p>
                                Con una visión de alcance nacional, contamos con sedes estratégicas en las regiones de <span class="font-black text-[#1e3a8a]">Cusco y Lima</span>, brindando formación de calidad en sectores como <span class="text-blue-900 font-bold italic">La Encalada</span> y <span class="text-blue-900 font-bold italic">Santa Anita</span>. Nuestra academia transforma el talento natural en excelencia deportiva.
                            </p>
                            <div class="grid grid-cols-2 gap-6 pt-4">
                                <div class="flex items-center gap-3">
                                    <div class="bg-[#eab308] p-2 rounded-lg"><i data-lucide="award" class="text-[#1e3a8a] w-5 h-5"></i></div>
                                    <span class="font-black uppercase text-xs text-[#1e3a8a]">Sede Cusco - Lima</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="bg-[#eab308] p-2 rounded-lg"><i data-lucide="shield" class="text-[#1e3a8a] w-5 h-5"></i></div>
                                    <span class="font-black uppercase text-xs text-[#1e3a8a]">Club Registrado</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="relative text-center">
                        <div class="rounded-[3rem] overflow-hidden shadow-2xl border-8 border-white transform hover:scale-[1.02] transition-transform duration-500 max-w-md mx-auto">
                            <img src="flyer.jpg" alt="Reseña Club" class="w-full h-full object-cover min-h-[400px]" onerror="this.src='https://images.unsplash.com/photo-1510566337590-2fc1f21d0faa?auto=format&fit=crop&q=80&w=1000'">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tarjetas Informativas -->
        <div class="py-24 bg-white px-6">
            <div class="max-w-7xl mx-auto grid md:grid-cols-3 gap-12">
                <div class="p-12 rounded-[3rem] bg-slate-50 border border-slate-100 text-center group hover:bg-blue-900 transition-colors">
                    <i data-lucide="users" class="w-12 h-12 text-[#1e3a8a] group-hover:text-white mx-auto mb-6"></i>
                    <h3 class="font-black text-2xl mb-4 text-[#1e3a8a] group-hover:text-[#eab308] uppercase italic">Entrenadores</h3>
                    <p class="text-slate-500 group-hover:text-blue-100">Staff técnico certificado con amplia trayectoria en ligas competitivas.</p>
                </div>

                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front shadow-lg">
                            <i data-lucide="calendar" class="w-12 h-12 text-[#1e3a8a] mb-6"></i>
                            <h3 class="font-black text-2xl mb-4 text-[#1e3a8a] uppercase italic">Horarios</h3>
                            <p class="text-slate-500">Sesiones dinámicas diseñadas para no interferir con las clases escolares.</p>
                            <span class="mt-6 text-[10px] font-black text-[#eab308] uppercase tracking-widest animate-pulse">Pasa el cursor para ver más</span>
                        </div>
                        <div class="flip-card-back shadow-2xl border-4 border-[#eab308]">
                            <h3 class="font-black text-2xl mb-6 text-[#eab308] uppercase italic">Nuestros Turnos</h3>
                            <div class="space-y-4 text-left w-full">
                                <div class="border-b border-white/10 pb-2">
                                    <p class="text-[10px] font-black text-[#eab308] uppercase">Sub 4 - Sub 7</p>
                                    <p class="text-sm font-bold">Lun - Mié - Vie: 4:00 PM</p>
                                </div>
                                <div class="border-b border-white/10 pb-2">
                                    <p class="text-[10px] font-black text-[#eab308] uppercase">Sub 8 - Sub 12</p>
                                    <p class="text-sm font-bold">Mar - Jue: 4:00 PM</p>
                                </div>
                                <div>
                                    <p class="text-[10px] font-black text-[#eab308] uppercase">Sábados Full</p>
                                    <p class="text-sm font-bold">9:00 AM a 12:30 PM</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-12 rounded-[3rem] bg-slate-50 border border-slate-100 text-center group hover:bg-blue-900 transition-colors">
                    <i data-lucide="trophy" class="w-12 h-12 text-[#1e3a8a] group-hover:text-white mx-auto mb-6"></i>
                    <h3 class="font-black text-2xl mb-4 text-[#1e3a8a] group-hover:text-[#eab308] uppercase italic">Torneos</h3>
                    <p class="text-slate-500 group-hover:text-blue-100">Participación constante en copas regionales y ligas federadas.</p>
                </div>
            </div>
        </div>

        <!-- Multimedia -->
        <div class="py-24 bg-blue-900 px-6">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-white text-5xl font-black italic uppercase text-center mb-16">Nuestra <span class="text-[#eab308]">Identidad</span></h2>
                <div class="grid lg:grid-cols-2 gap-12 items-center">
                    <div class="space-y-6">
                        <div class="flex items-center gap-2 text-[#eab308] font-bold uppercase text-xs tracking-widest">
                            <i data-lucide="play" class="w-4 h-4 fill-current"></i> Video Oficial
                        </div>
                        <div class="aspect-video bg-black rounded-[3rem] overflow-hidden shadow-2xl border-4 border-blue-800">
                            <video class="w-full h-full object-cover" controls src="video.mp4"></video>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="flex items-center gap-2 text-[#eab308] font-bold uppercase text-xs tracking-widest">
                            <i data-lucide="image" class="w-4 h-4"></i> Galería en Vivo
                        </div>
                        <div class="relative h-[400px] rounded-[3rem] overflow-hidden shadow-2xl border-4 border-white" id="carousel-frame">
                            <img src="1.jpg" class="carousel-item active" onerror="this.style.display='none'">
                            <img src="2.jpg" class="carousel-item" onerror="this.style.display='none'">
                            <img src="3.jpg" class="carousel-item" onerror="this.style.display='none'">
                            <img src="5.jpg" class="carousel-item" onerror="this.style.display='none'">
                            <img src="6.jpg" class="carousel-item" onerror="this.style.display='none'">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- PÁGINA: INSCRIPCIÓN -->
    <section id="page-register" class="page-section py-20 px-4 bg-slate-100 min-h-screen">
        <div class="max-w-3xl mx-auto bg-white rounded-[3.5rem] shadow-2xl overflow-hidden">
            <div id="registration-container">
                <div class="bg-blue-900 p-16 text-center relative overflow-hidden">
                    <div class="absolute -top-10 -right-10 w-40 h-40 bg-yellow-500/20 rounded-full"></div>
                    <h2 class="text-white text-4xl md:text-5xl font-black uppercase italic tracking-tighter">Ficha de Ingreso</h2>
                    <p class="text-[#eab308] mt-4 font-black uppercase text-xs tracking-[0.4em]">Temporada 2024-2025</p>
                </div>
                
                <form id="form-registration" class="p-12 space-y-8">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-2">
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2">Padre / Madre / Tutor</label>
                            <input required name="parent" type="text" placeholder="Ej. Carlos Mendoza" class="w-full p-5 bg-slate-50 border-2 border-slate-100 focus:border-[#eab308] rounded-2xl outline-none transition-all font-semibold">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2">Nombre del Alumno</label>
                            <input required name="student" type="text" placeholder="Nombre completo" class="w-full p-5 bg-slate-50 border-2 border-slate-100 focus:border-[#eab308] rounded-2xl outline-none transition-all font-semibold">
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-2">
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2">Fecha de Nacimiento</label>
                            <input required name="birthDate" type="date" class="w-full p-5 bg-slate-50 border-2 border-slate-100 focus:border-[#eab308] rounded-2xl outline-none transition-all font-semibold">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2">Categoría</label>
                            <select required name="category" class="w-full p-5 bg-slate-50 border-2 border-slate-100 focus:border-[#eab308] rounded-2xl outline-none transition-all font-semibold appearance-none">
                                <option value="" disabled selected>Seleccione categoría</option>
                                <option value="Sub 4 – 5 años (futuro)">Sub 4 – 5 años (futuro)</option>
                                <option value="Sub 6 – 7 años (Promesa y balón)">Sub 6 – 7 años (Promesa y balón)</option>
                                <option value="Sub 8 – 9 años (promesa y toque)">Sub 8 – 9 años (promesa y toque)</option>
                                <option value="Sub 10 – 12 años (promesa y pase)">Sub 10 – 12 años (promesa y pase)</option>
                            </select>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-400 ml-2">Teléfono de Contacto</label>
                        <input required name="phone" type="tel" placeholder="+51 000 000 000" class="w-full p-5 bg-slate-50 border-2 border-slate-100 focus:border-[#eab308] rounded-2xl outline-none transition-all font-semibold">
                    </div>
                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                        <div class="flex items-start gap-4">
                            <input type="checkbox" id="policy-check" class="mt-1.5 w-5 h-5 cursor-pointer" onchange="window.toggleSubmitBtn()">
                            <label for="policy-check" class="text-xs text-slate-600 leading-relaxed cursor-pointer select-none">
                                <span class="font-black text-blue-900 uppercase block mb-1">Autorización de Uso de Imagen</span>
                                Autorizo al CLUB SEÑOR CRISTO ASCENSION para utilizar imágenes o videos del menor durante las actividades deportivas.
                            </label>
                        </div>
                    </div>
                    <button type="submit" id="reg-submit-btn" disabled class="w-full bg-blue-900 text-white font-black py-7 rounded-3xl text-xl uppercase transition-all shadow-xl flex items-center justify-center gap-4">
                        Enviar Inscripción <i data-lucide="send"></i>
                    </button>
                </form>
            </div>

            <div id="success-view" class="hidden p-16 text-center space-y-8 success-animation">
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto"><i data-lucide="check-circle" class="text-green-600 w-12 h-12"></i></div>
                <h2 class="text-3xl font-black text-blue-900 uppercase italic">¡Inscripción Exitosa!</h2>
                <div class="flex flex-col gap-4 max-w-xs mx-auto">
                    <a id="whatsapp-link" href="#" target="_blank" class="bg-green-600 text-white font-black py-4 rounded-2xl flex items-center justify-center gap-3 shadow-lg uppercase text-sm">WhatsApp</a>
                    <button onclick="window.resetRegistration()" class="bg-blue-900 text-white font-black py-4 rounded-2xl uppercase text-sm">Nuevo Registro</button>
                    <button onclick="window.showPage('home')" class="bg-slate-100 text-slate-600 font-bold py-4 rounded-2xl uppercase text-xs">Inicio</button>
                </div>
            </div>
        </div>
    </section>

    <!-- PÁGINA: ADMIN -->
    <section id="page-admin" class="page-section hidden py-24 px-6 admin-dark-bg min-h-screen">
        <div id="admin-auth" class="max-w-md mx-auto bg-white p-12 rounded-[3.5rem] shadow-2xl text-center">
            <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-8"><i data-lucide="lock" class="text-blue-900 w-10 h-10"></i></div>
            <h2 class="text-3xl font-black mb-10 text-blue-900 uppercase italic">Acceso Directivo</h2>
            <input id="admin-key-input" type="password" placeholder="Clave" class="w-full p-6 bg-slate-50 border-2 border-slate-100 rounded-2xl outline-none focus:border-blue-900 text-center font-black tracking-widest text-lg mb-6">
            <button onclick="window.tryAdminAccess()" class="w-full bg-blue-900 text-white font-black py-5 rounded-2xl uppercase tracking-widest">Desbloquear</button>
        </div>

        <div id="admin-dashboard" class="hidden max-w-7xl mx-auto space-y-8 animate-in fade-in duration-700">
            <div class="flex flex-col lg:flex-row justify-between items-center bg-white p-10 rounded-[3.5rem] shadow-2xl border-l-[12px] border-[#eab308]">
                <div>
                    <h2 class="text-4xl font-black text-blue-900 uppercase italic">Gestión de Alumnos</h2>
                    <p class="text-slate-400 font-black uppercase text-[10px] tracking-widest mt-2" id="reg-counter italic">Sincronizado con la nube...</p>
                </div>
                <div class="flex gap-4">
                    <button onclick="window.exportToExcel()" class="bg-green-600 text-white font-black py-4 px-10 rounded-2xl flex items-center gap-3 shadow-xl uppercase text-xs">Excel</button>
                    <button onclick="window.exitAdmin()" class="bg-slate-100 text-slate-500 font-black py-4 px-8 rounded-2xl uppercase text-xs">Salir</button>
                </div>
            </div>
            <div class="bg-white rounded-[3.5rem] overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="bg-slate-50 text-blue-900 uppercase text-[10px] font-black border-b">
                                <th class="px-10 py-8">Deportista</th>
                                <th class="px-10 py-8">Representante</th>
                                <th class="px-10 py-8 text-center">Nacimiento</th>
                                <th class="px-10 py-8 text-center">Categoría</th>
                                <th class="px-10 py-8 text-center">Contacto</th>
                                <th class="px-10 py-8 text-right">Registrado</th>
                                <th class="px-6 py-8 text-center">Acción</th>
                            </tr>
                        </thead>
                        <tbody id="admin-data-rows" class="divide-y divide-slate-50 font-semibold text-sm"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-slate-950 text-white py-20 px-6 border-t-[10px] border-[#eab308]">
        <div class="max-w-7xl mx-auto text-center md:text-left">
            <div class="flex items-center justify-center md:justify-start gap-3 mb-4">
                <img src="logo.jpg" alt="Logo" class="logo-img" style="width: 35px; height: 35px;" onerror="this.src='https://img.icons8.com/color/96/football.png'">
                <span class="font-black text-2xl uppercase tracking-tighter italic">CLUB SECRISAS</span>
            </div>
            <p class="text-slate-500 text-sm italic">Sedes Cusco y Lima. Fundación 23 de agosto de 2015. © 2024</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // CONFIGURACIÓN DE FIREBASE (Asegúrate de que estos datos sean los tuyos)
        const DEFAULT_CONFIG = {
            apiKey: "AIzaSyDM9bXKiQE614I0SC1otHUKzKM_NSp5uxU",
            authDomain: "clubcristoascension.firebaseapp.com",
            projectId: "clubcristoascension",
            storageBucket: "clubcristoascension.firebasestorage.app",
            messagingSenderId: "232835967670",
            appId: "1:232835967670:web:50e9929315f28d8cfed417"
        };

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : DEFAULT_CONFIG;
        const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'cristo-ascension-club-prod-v1';
        
        let app, auth, db, isFirebaseActive = false;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            isFirebaseActive = true;
        } catch (e) { console.error("Error al conectar Firebase"); }

        let regsCache = [];
        let syncUnsubscribe = null;

        window.showPage = (id) => {
            if(id === 'register') window.resetRegistration();
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(`page-${id}`);
            if (target) {
                target.classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                setTimeout(() => lucide.createIcons(), 50);
            }
        };

        window.toggleSubmitBtn = () => {
            const check = document.getElementById('policy-check');
            const btn = document.getElementById('reg-submit-btn');
            if (check && btn) btn.disabled = !check.checked;
        };

        window.tryAdminAccess = () => {
            const key = document.getElementById('admin-key-input').value;
            if (key.trim() === 'admin123') {
                document.getElementById('admin-auth').classList.add('hidden');
                document.getElementById('admin-dashboard').classList.remove('hidden');
                initSync();
            } else { alert("Clave incorrecta."); }
        };

        window.exitAdmin = () => {
            if (syncUnsubscribe) syncUnsubscribe();
            document.getElementById('admin-auth').classList.remove('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-key-input').value = '';
            regsCache = [];
        };

        window.resetRegistration = () => {
            document.getElementById('registration-container').classList.remove('hidden');
            document.getElementById('success-view').classList.add('hidden');
            document.getElementById('form-registration').reset();
            window.toggleSubmitBtn(); 
            setTimeout(() => lucide.createIcons(), 50);
        };

        window.exportToExcel = () => {
            if (regsCache.length === 0) return alert("No hay datos.");
            const h = `<tr style="background-color: #1e3a8a; color: #ffffff; font-weight: bold;"><th style="border: 1px solid #000; padding: 10px;">Alumno</th><th style="border: 1px solid #000; padding: 10px;">Representante</th><th style="border: 1px solid #000; padding: 10px;">Nacimiento</th><th style="border: 1px solid #000; padding: 10px;">Categoria</th><th style="border: 1px solid #000; padding: 10px;">WhatsApp</th><th style="border: 1px solid #000; padding: 10px;">Fecha Reg</th></tr>`;
            const r = regsCache.map(x => `<tr><td style="border: 1px solid #000; padding: 8px;">${x.student}</td><td style="border: 1px solid #000; padding: 8px;">${x.parent}</td><td style="border: 1px solid #000; padding: 8px;">${x.birthDate}</td><td style="border: 1px solid #000; padding: 8px;">${x.category}</td><td style="border: 1px solid #000; padding: 8px;">${x.phone}</td><td style="border: 1px solid #000; padding: 8px;">${new Date(x.timestamp).toLocaleDateString()}</td></tr>`).join("");
            const t = `<html><head><meta charset="UTF-8"></head><body><table style="border-collapse: collapse;">${h}${r}</table></body></html>`;
            const b = new Blob([t], { type: 'application/vnd.ms-excel' });
            const u = URL.createObjectURL(b);
            const a = document.createElement("a"); a.href = u; a.download = "ALUMNOS_SECRISAS.xls"; a.click();
        };

        window.deleteEntry = async (id, ts) => {
            if (!confirm("¿Eliminar registro?")) return;
            if (isFirebaseActive && id) {
                try { await deleteDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'registrations', id)); } catch (e) { }
            }
        };

        const initSync = () => {
            if (isFirebaseActive) {
                const q = collection(db, 'artifacts', currentAppId, 'public', 'data', 'registrations');
                syncUnsubscribe = onSnapshot(q, (snap) => {
                    regsCache = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    renderTable();
                });
            }
        };

        const renderTable = () => {
            const tbody = document.getElementById('admin-data-rows');
            if (!tbody) return; tbody.innerHTML = '';
            document.getElementById('reg-counter').textContent = `${regsCache.length} Alumnos en el sistema global`;
            [...regsCache].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).forEach(r => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-blue-50/50 transition-colors border-b border-slate-50';
                tr.innerHTML = `<td class="px-10 py-7 font-black text-blue-900 uppercase text-xs">${r.student}</td><td class="px-10 py-7 text-slate-500 text-xs font-bold">${r.parent}</td><td class="px-10 py-7 text-center font-mono text-xs font-bold text-slate-400">${r.birthDate}</td><td class="px-10 py-7 text-center"><span class="bg-blue-900 text-white text-[9px] font-black px-4 py-1.5 rounded-full uppercase">${r.category}</span></td><td class="px-10 py-7 text-center text-blue-900 font-black text-xs underline decoration-[#eab308]">${r.phone}</td><td class="px-10 py-7 text-right text-[10px] text-slate-300 font-mono italic">${new Date(r.timestamp).toLocaleDateString()}</td><td class="px-6 py-7 text-center"><button onclick="window.deleteEntry('${r.id || ''}', '${r.timestamp}')" class="text-red-400 hover:text-red-700 transition-colors p-2"><i data-lucide="trash-2" class="w-5 h-5"></i></button></td>`;
                tbody.appendChild(tr);
            });
            lucide.createIcons();
        };

        document.getElementById('form-registration').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('reg-submit-btn'); btn.disabled = true;
            const fd = new FormData(e.target);
            const data = {
                parent: fd.get('parent'), student: fd.get('student'), birthDate: fd.get('birthDate'),
                category: fd.get('category'), phone: fd.get('phone'), timestamp: new Date().toISOString()
            };
            
            // WHATSAPP LIMPIO SIN SÍMBOLOS (+393883909873)
            const waClean = "51997548587"; // Número oficial del club
            // MENSAJE PREPARADO PARA WHATSAPP
            const waText = `Inscripción Club Secrisas:
Alumno: ${data.student}
Cat: ${data.category}
F.Nac: ${data.birthDate.split('-').reverse().join('/')}`;
            
            document.getElementById('whatsapp-link').setAttribute('href', `https://api.whatsapp.com/send?phone=${waClean}&text=${encodeURIComponent(waText)}`);

            if (isFirebaseActive) {
                try { await addDoc(collection(db, 'artifacts', currentAppId, 'public', 'data', 'registrations'), data); } catch (e) { }
            }
            document.getElementById('registration-container').classList.add('hidden');
            document.getElementById('success-view').classList.remove('hidden');
            btn.disabled = false; lucide.createIcons();
        });

        // CARRUSEL REFORZADO
        const initCarousel = () => {
            let cur = 0; const items = document.querySelectorAll('.carousel-item');
            if (items.length <= 1) return;
            setInterval(() => {
                items[cur].classList.remove('active');
                cur = (cur + 1) % items.length;
                items[cur].classList.add('active');
            }, 3500);
        };

        const startApp = async () => {
            if (isFirebaseActive) { try { await signInAnonymously(auth); } catch(e) { } }
            lucide.createIcons(); initCarousel();
        };
        startApp();
    </script>
</body>
</html>
